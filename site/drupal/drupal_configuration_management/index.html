
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Soulweb Documentation">
      
      
        <link rel="canonical" href="http://soulweb.docsvm.dev/drupal/drupal_configuration_management/">
      
      
        <meta name="author" content="Soulweb Team">
      
      
        <link rel="shortcut icon" href="../../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.5.3">
    
    
      
        <title>Configuration Management (CMI) - Soulweb Docs</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-56ade86843.js"></script>
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-b168d32589.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-f78e5cb881.palette.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="light-blue" data-md-color-accent="cyan">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="http://soulweb.docsvm.dev" title="Soulweb Docs" class="md-logo md-header-nav__button">
            <img src="../../img/logo.svg" width="24" height="24">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Drupal 8
                </span>
              
            
            Configuration Management (CMI)
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
            


  


  <a href="https://github.com/mecmartini/soulweb-docs" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      mecmartini/soulweb-docs
    </div>
  </a>

          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-logo md-nav__button">
        <img src="../../img/logo.svg">
      </i>
    
    Soulweb Docs
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/mecmartini/soulweb-docs" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      mecmartini/soulweb-docs
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Drupal 8
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Drupal 8
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../drupal_development_workflow/" title="Development Workflow" class="md-nav__link">
      Development Workflow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Local Development
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Local Development
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2-1" type="checkbox" id="nav-2-2-1">
    
    <label class="md-nav__link" for="nav-2-2-1">
      macOS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-2-1">
        macOS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../drupal_vm/" title="Drupal VM" class="md-nav__link">
      Drupal VM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../drupal_vm_phpstorm/" title="PhpStorm" class="md-nav__link">
      PhpStorm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../drupal_vm_xdebug/" title="Xdebug" class="md-nav__link">
      Xdebug
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../drupal_vm_codersniffer/" title="Coder Sniffer" class="md-nav__link">
      Coder Sniffer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../drupal_vm_eslint/" title="ESLint" class="md-nav__link">
      ESLint
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../drupal_vm_precommit/" title="Pre Commit Hook" class="md-nav__link">
      Pre Commit Hook
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../drupal_vm_phpunit/" title="PHPUnit" class="md-nav__link">
      PHPUnit
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../drupal_basic_configuration/" title="Basic Configuration" class="md-nav__link">
      Basic Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../drupal_composer/" title="Using Composer" class="md-nav__link">
      Using Composer
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Configuration Management (CMI)
      </label>
    
    <a href="./" title="Configuration Management (CMI)" class="md-nav__link md-nav__link--active">
      Configuration Management (CMI)
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction-to-drupal-cmi" title="Introduction to Drupal CMI" class="md-nav__link">
    Introduction to Drupal CMI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#different-configurations-on-dev-stage-prod-environments" title="Different configurations on Dev / Stage / Prod environments" class="md-nav__link">
    Different configurations on Dev / Stage / Prod environments
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#override-configuration" title="Override Configuration" class="md-nav__link">
    Override Configuration
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../drupal_deploy_content/" title="Deploy Content" class="md-nav__link">
      Deploy Content
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../drupal_cors/" title="CORS Configuration" class="md-nav__link">
      CORS Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../drupal_multisite/" title="Multisite" class="md-nav__link">
      Multisite
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction-to-drupal-cmi" title="Introduction to Drupal CMI" class="md-nav__link">
    Introduction to Drupal CMI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#different-configurations-on-dev-stage-prod-environments" title="Different configurations on Dev / Stage / Prod environments" class="md-nav__link">
    Different configurations on Dev / Stage / Prod environments
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#override-configuration" title="Override Configuration" class="md-nav__link">
    Override Configuration
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="configuration-management">Configuration Management<a class="headerlink" href="#configuration-management" title="Permanent link">&para;</a></h1>
<h2 id="introduction-to-drupal-cmi">Introduction to Drupal CMI<a class="headerlink" href="#introduction-to-drupal-cmi" title="Permanent link">&para;</a></h2>
<p><a href="https://www.drupal.org/docs/8/configuration-management">Configuration Management</a></p>
<p>First of all, you need to understand, how the configuration management in Drupal 8 works. CMI allows you to export all configurations and its dependencies from the database into yml text files. To make sure, you never end up in an inconsistent state, CMI always exports everything. By default, you cannot exclude certain configurations.</p>
<p>To export the configuration you must set the export directory in your Drupal settings. See <a href="../drupal_basic_configuration/#5-configuration-directory">Configuration directory</a>.</p>
<p>Than you can export with:</p>
<div class="codehilite"><pre><span></span>drush config-export
</pre></div>


<p>If you change some configuration on the database, these configurations will be reverted in the next deployment when you use:</p>
<div class="codehilite"><pre><span></span>drush config-import
</pre></div>


<p>This is helpful and will make sure, you have the same configuration on all your systems.</p>
<h2 id="different-configurations-on-dev-stage-prod-environments">Different configurations on Dev / Stage / Prod environments<a class="headerlink" href="#different-configurations-on-dev-stage-prod-environments" title="Permanent link">&para;</a></h2>
<p>You want to have different configurations on your environments. For example, we have installed a “devel” module only on our local environment but we want to have it disabled on the live environment.</p>
<p>This can be achieved by using the <a href="https://www.drupal.org/project/config_split">Configuration Split</a> module.</p>
<p>Configuration split exposes a configuration entity which controls what you want to split off. Currently you can</p>
<ul>
<li><code>blacklist modules</code>: any configuration that this module owns will automatically be blacklisted too.</li>
<li><code>blacklist configuration</code>: settings or configuration entities. These will be removed from the active sync directory.</li>
<li><code>graylist configuration</code>: settings or configuration entities. These will not be removed if they are in the active sync directory, but also not exported if they are not there yet.</li>
</ul>
<p>As default, we have <code>Dev</code> / <code>Stage</code> / <code>Prod</code> config environments already set up and configured on our drupal projects. Those are set to inactive. You must enable the <code>Dev</code> environment on your local environment to import / export is config. Open the <code>settings.local.php</code> and add this line:</p>
<div class="codehilite"><pre><span></span>$config[&#39;config_split.config_split.dev&#39;][&#39;status&#39;] = TRUE;
</pre></div>


<p>If those config environments are not yet set, you can create them when needed but be sure to name them with the following <code>machine name</code>:</p>
<ul>
<li><code>dev</code></li>
<li><code>stage</code></li>
<li><code>prod</code></li>
</ul>
<p>as those are the defaults for our projects.</p>
<p>Now you can use normal <code>drush</code> import /export commands and <code>Configuration Split</code> we'll do the magic for you:</p>
<div class="codehilite"><pre><span></span># To export configuration
drush cex -y
# To import configuration
drush cim -y
</pre></div>


<h2 id="override-configuration">Override Configuration<a class="headerlink" href="#override-configuration" title="Permanent link">&para;</a></h2>
<p>In development, it's convenient to have different configuration then on the production site (e.g. different error reporting, different API keys, different site email, etc.):</p>
<p>These customizations are not to be exported.</p>
<p>The <code>$config</code> array allows run-time overriding: configuration is still there, but it gets overridden.</p>
<p>These customizations must be added to:</p>
<ul>
<li><code>settings.local.php</code> if they are needed only for your local environment (see <a href="../drupal_basic_configuration/#3-create-and-enable-local-settings">Create and enable local settings</a>)</li>
<li><code>settings.dev.php</code> if they are needed for all dev environments (already available on the repository)</li>
</ul>
<p>As example, to enable verbose error logging on your instance add:</p>
<div class="codehilite"><pre><span></span>$config[&#39;system.logging&#39;][&#39;error_level&#39;] = &#39;verbose&#39;;
</pre></div>


<p>After the override, the <code>drupal</code> backend UI still shows the original (non-overridden) settings. This is wanted to prevent you from submitting overriden configuration. So, even after the override, <code>drupal</code> exports the original settings.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../drupal_composer/" title="Using Composer" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Using Composer
              </span>
            </div>
          </a>
        
        
          <a href="../drupal_deploy_content/" title="Deploy Content" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Deploy Content
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 Soulweb Solutions Ltd.
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-ae2e7c9801.js"></script>
      <script>app.initialize({url:{base:"../.."}})</script>
      
    
    
      
      <script>!function(e,t,a,n,o,c,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),i=t.getElementsByTagName(a)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-99054399-1","soulwebdocs.udpdev.com"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",t,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>